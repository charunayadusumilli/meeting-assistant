{"version":3,"file":"log.js","sources":["../../src/main/log.ts"],"sourcesContent":["import { Client, Event } from '@sentry/core';\n\ninterface Attributes {\n  'os.name'?: string;\n  'os.version'?: string;\n  'device.brand'?: string;\n  'device.model'?: string;\n  'device.family'?: string;\n}\n\n/**\n * Fetch os and device attributes from the Context and AdditionalContext integrations\n */\nasync function getAttributes(client: Client): Promise<Attributes> {\n  const contextIntegration = client.getIntegrationByName('Context');\n  const additionalContextIntegration = client.getIntegrationByName('AdditionalContext');\n\n  let event: Event = {};\n  const hint = {};\n\n  event = (await contextIntegration?.processEvent?.(event, hint, client)) || event;\n  event = (await additionalContextIntegration?.processEvent?.(event, hint, client)) || event;\n\n  const attrs: Attributes = {};\n  if (event.contexts?.os?.name) {\n    attrs['os.name'] = event.contexts.os.name;\n  }\n  if (event.contexts?.os?.version) {\n    attrs['os.version'] = event.contexts.os.version;\n  }\n  if (event.contexts?.device?.brand) {\n    attrs['device.brand'] = event.contexts.device.brand;\n  }\n  if (event.contexts?.device?.model) {\n    attrs['device.model'] = event.contexts.device.model;\n  }\n  if (event.contexts?.device?.family) {\n    attrs['device.family'] = event.contexts.device.family;\n  }\n  return attrs;\n}\n\n// Cached attributes\nlet attributes: Attributes | undefined;\n\n/**\n * Get OS and device attributes for logs\n *\n * Some of this context is only available asynchronously, so we fetch it once\n * and cache it for future logs. Logs before the attributes are resolved will not\n * have this context.\n */\nexport function getOsDeviceLogAttributes(client: Client): Attributes {\n  if (attributes === undefined) {\n    // We set attributes to an empty object to indicate that we are already fetching them\n    attributes = {};\n\n    getAttributes(client)\n      .then((attrs) => {\n        attributes = attrs;\n      })\n      .catch(() => {\n        // ignore\n      });\n  }\n\n  return attributes || {};\n}\n"],"names":[],"mappings":"AAUA;;AAEG;AACH,eAAe,aAAa,CAAC,MAAc,EAAA;IACzC,MAAM,kBAAkB,GAAG,MAAM,CAAC,oBAAoB,CAAC,SAAS,CAAC;IACjE,MAAM,4BAA4B,GAAG,MAAM,CAAC,oBAAoB,CAAC,mBAAmB,CAAC;IAErF,IAAI,KAAK,GAAU,EAAE;IACrB,MAAM,IAAI,GAAG,EAAE;AAEf,IAAA,KAAK,GAAG,CAAC,MAAM,kBAAkB,EAAE,YAAY,GAAG,KAAK,EAAE,IAAI,EAAE,MAAM,CAAC,KAAK,KAAK;AAChF,IAAA,KAAK,GAAG,CAAC,MAAM,4BAA4B,EAAE,YAAY,GAAG,KAAK,EAAE,IAAI,EAAE,MAAM,CAAC,KAAK,KAAK;IAE1F,MAAM,KAAK,GAAe,EAAE;AAC5B,IAAA,IAAI,KAAK,CAAC,QAAQ,EAAE,EAAE,EAAE,IAAI,EAAE;QAC5B,KAAK,CAAC,SAAS,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI;AAC1C,IAAA;AACD,IAAA,IAAI,KAAK,CAAC,QAAQ,EAAE,EAAE,EAAE,OAAO,EAAE;QAC/B,KAAK,CAAC,YAAY,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,OAAO;AAChD,IAAA;AACD,IAAA,IAAI,KAAK,CAAC,QAAQ,EAAE,MAAM,EAAE,KAAK,EAAE;QACjC,KAAK,CAAC,cAAc,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK;AACpD,IAAA;AACD,IAAA,IAAI,KAAK,CAAC,QAAQ,EAAE,MAAM,EAAE,KAAK,EAAE;QACjC,KAAK,CAAC,cAAc,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK;AACpD,IAAA;AACD,IAAA,IAAI,KAAK,CAAC,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE;QAClC,KAAK,CAAC,eAAe,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM;AACtD,IAAA;AACD,IAAA,OAAO,KAAK;AACd;AAEA;AACA,IAAI,UAAkC;AAEtC;;;;;;AAMG;AACG,SAAU,wBAAwB,CAAC,MAAc,EAAA;IACrD,IAAI,UAAU,KAAK,SAAS,EAAE;;QAE5B,UAAU,GAAG,EAAE;QAEf,aAAa,CAAC,MAAM;AACjB,aAAA,IAAI,CAAC,CAAC,KAAK,KAAI;YACd,UAAU,GAAG,KAAK;AACpB,QAAA,CAAC;aACA,KAAK,CAAC,MAAK;;AAEZ,QAAA,CAAC,CAAC;AACL,IAAA;IAED,OAAO,UAAU,IAAI,EAAE;AACzB;;;;"}