{"version":3,"file":"event-loop-blocked-integration.js","sources":["../../src/native/event-loop-blocked-integration.ts"],"sourcesContent":["import { defineIntegration, Integration } from '@sentry/core';\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport {\n  disableBlockDetectionForCallback,\n  eventLoopBlockIntegration as nodeEventLoopBlockIntegration,\n  pauseEventLoopBlockDetection,\n  restartEventLoopBlockDetection,\n} from '@sentry/node-native';\nimport { app, powerMonitor } from 'electron';\n\ntype IntegrationInternal = { start: () => void; stop: () => void };\n\ntype Options = Parameters<typeof nodeEventLoopBlockIntegration>[0];\n\n/**\n * > **Note**\n * >\n * > You should add `@sentry/node-native` to your dependencies to use this integration.\n *\n * Monitors the Node.js event loop for blocking behavior and reports blocked events to Sentry.\n *\n * Uses a background worker and native module to detect when the main thread is blocked for longer than the configured\n * threshold (default: 1 second). When a block is detected, it captures an event with stack traces for every thread.\n *\n * ```js\n * import * as Sentry from '@sentry/electron/main';\n * import { eventLoopBlockIntegration } from '@sentry/electron/native';\n *\n * Sentry.init({\n *   dsn: '__YOUR_DSN__',\n *   integrations: [\n *     eventLoopBlockIntegration({\n *       threshold: 500, // Report blocks longer than 500ms\n *     }),\n *   ],\n * });\n * ```\n */\nexport const eventLoopBlockIntegration: (options: Options) => Integration = defineIntegration(\n  (options: Options = {}) => {\n    if (process.type === 'renderer') {\n      throw new Error(\n        'Detected `eventLoopBlockIntegration` in renderer process. This integration should only be used in the Electron main process.',\n      );\n    }\n\n    const integration = nodeEventLoopBlockIntegration({\n      ...options,\n      staticTags: {\n        'event.environment': 'javascript',\n        'event.origin': 'electron',\n        'event.process': 'browser',\n        ...options.staticTags,\n      },\n      appRootPath: app.getAppPath(),\n    }) as Integration & IntegrationInternal;\n\n    powerMonitor.on('suspend', () => {\n      integration.stop();\n    });\n\n    powerMonitor.on('lock-screen', () => {\n      integration.stop();\n    });\n\n    powerMonitor.on('resume', () => {\n      integration.start();\n    });\n\n    powerMonitor.on('unlock-screen', () => {\n      integration.start();\n    });\n\n    return integration;\n  },\n);\n\nexport { disableBlockDetectionForCallback, pauseEventLoopBlockDetection, restartEventLoopBlockDetection };\n"],"names":["nodeEventLoopBlockIntegration"],"mappings":";;;;;AAcA;;;;;;;;;;;;;;;;;;;;;;;AAuBG;AACI,MAAM,yBAAyB,GAAsC,iBAAiB,CAC3F,CAAC,OAAA,GAAmB,EAAE,KAAI;AACxB,IAAA,IAAI,OAAO,CAAC,IAAI,KAAK,UAAU,EAAE;AAC/B,QAAA,MAAM,IAAI,KAAK,CACb,8HAA8H,CAC/H;AACF,IAAA;IAED,MAAM,WAAW,GAAGA,2BAA6B,CAAC;AAChD,QAAA,GAAG,OAAO;AACV,QAAA,UAAU,EAAE;AACV,YAAA,mBAAmB,EAAE,YAAY;AACjC,YAAA,cAAc,EAAE,UAAU;AAC1B,YAAA,eAAe,EAAE,SAAS;YAC1B,GAAG,OAAO,CAAC,UAAU;AACtB,SAAA;AACD,QAAA,WAAW,EAAE,GAAG,CAAC,UAAU,EAAE;AAC9B,KAAA,CAAsC;AAEvC,IAAA,YAAY,CAAC,EAAE,CAAC,SAAS,EAAE,MAAK;QAC9B,WAAW,CAAC,IAAI,EAAE;AACpB,IAAA,CAAC,CAAC;AAEF,IAAA,YAAY,CAAC,EAAE,CAAC,aAAa,EAAE,MAAK;QAClC,WAAW,CAAC,IAAI,EAAE;AACpB,IAAA,CAAC,CAAC;AAEF,IAAA,YAAY,CAAC,EAAE,CAAC,QAAQ,EAAE,MAAK;QAC7B,WAAW,CAAC,KAAK,EAAE;AACrB,IAAA,CAAC,CAAC;AAEF,IAAA,YAAY,CAAC,EAAE,CAAC,eAAe,EAAE,MAAK;QACpC,WAAW,CAAC,KAAK,EAAE;AACrB,IAAA,CAAC,CAAC;AAEF,IAAA,OAAO,WAAW;AACpB,CAAC;;;;"}