{"version":3,"file":"index.js","sources":["../../src/preload/index.ts"],"sourcesContent":["/**\n * This preload script may be used with sandbox mode enabled which means regular require is not available.\n */\n\nimport { SerializedLog } from '@sentry/core';\nimport { contextBridge, ipcRenderer } from 'electron';\nimport { ipcChannelUtils, RendererStatus } from '../common/ipc.js';\n\n/**\n * Hook up IPC to the window object and uses contextBridge if available.\n *\n * @param namespace An optional namespace to use for the IPC channels\n */\nexport function hookupIpc(namespace: string = 'sentry-ipc'): void {\n  const ipcUtil = ipcChannelUtils(namespace);\n\n  // eslint-disable-next-line no-restricted-globals\n  window.__SENTRY_IPC__ = window.__SENTRY_IPC__ || {};\n\n  // eslint-disable-next-line no-restricted-globals\n  if (window.__SENTRY_IPC__[ipcUtil.namespace]) {\n    // eslint-disable-next-line no-console\n    console.log('Sentry Electron preload has already been run');\n  } else {\n    const ipcObject = {\n      sendRendererStart: () => ipcRenderer.send(ipcUtil.createKey('start')),\n      sendScope: (scopeJson: string) => ipcRenderer.send(ipcUtil.createKey('scope'), scopeJson),\n      sendEnvelope: (envelope: Uint8Array | string) => ipcRenderer.send(ipcUtil.createKey('envelope'), envelope),\n      sendStatus: (status: RendererStatus) => ipcRenderer.send(ipcUtil.createKey('status'), status),\n      sendStructuredLog: (log: SerializedLog) => ipcRenderer.send(ipcUtil.createKey('structured-log'), log),\n    };\n\n    // eslint-disable-next-line no-restricted-globals\n    window.__SENTRY_IPC__[ipcUtil.namespace] = ipcObject;\n\n    // We attempt to use contextBridge if it's available\n    if (contextBridge) {\n      // This will fail if contextIsolation is not enabled\n      try {\n        // eslint-disable-next-line no-restricted-globals\n        contextBridge.exposeInMainWorld('__SENTRY_IPC__', window.__SENTRY_IPC__);\n      } catch (e) {\n        //\n      }\n    }\n  }\n}\n"],"names":[],"mappings":";;;AAAA;;AAEG;AAMH;;;;AAIG;AACG,SAAU,SAAS,CAAC,SAAA,GAAoB,YAAY,EAAA;AACxD,IAAA,MAAM,OAAO,GAAG,eAAe,CAAC,SAAS,CAAC;;IAG1C,MAAM,CAAC,cAAc,GAAG,MAAM,CAAC,cAAc,IAAI,EAAE;;IAGnD,IAAI,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;;AAE5C,QAAA,OAAO,CAAC,GAAG,CAAC,8CAA8C,CAAC;AAC5D,IAAA;AAAM,SAAA;AACL,QAAA,MAAM,SAAS,GAAG;AAChB,YAAA,iBAAiB,EAAE,MAAM,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;AACrE,YAAA,SAAS,EAAE,CAAC,SAAiB,KAAK,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,EAAE,SAAS,CAAC;AACzF,YAAA,YAAY,EAAE,CAAC,QAA6B,KAAK,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,UAAU,CAAC,EAAE,QAAQ,CAAC;AAC1G,YAAA,UAAU,EAAE,CAAC,MAAsB,KAAK,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE,MAAM,CAAC;AAC7F,YAAA,iBAAiB,EAAE,CAAC,GAAkB,KAAK,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,gBAAgB,CAAC,EAAE,GAAG,CAAC;SACtG;;QAGD,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,SAAS;;AAGpD,QAAA,IAAI,aAAa,EAAE;;YAEjB,IAAI;;gBAEF,aAAa,CAAC,iBAAiB,CAAC,gBAAgB,EAAE,MAAM,CAAC,cAAc,CAAC;AACzE,YAAA;AAAC,YAAA,OAAO,CAAC,EAAE;;AAEX,YAAA;AACF,QAAA;AACF,IAAA;AACH;;;;"}